{% extends "_base_maronia.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3 page-header">
  <h1 class="h4 mb-0">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙØ§Øª Ù…Ø¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h1>
  <div class="btn-group" role="group" aria-label="Ø£ÙˆØ§Ù…Ø±">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'teacher_loads_dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù†ØµØ¨Ø©</a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'teacher_class_matrix' %}">Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ù†ØµØ¨Ø©</a>
  </div>
</div>

<div class="card p-3">
  <div class="row g-3">
    <div class="col-12 col-md-4">
      <div class="p-3 border rounded-3 bg-light h-100">
        <div class="text-muted small">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
        <div class="fw-bold">{% if term %}{{ term }}{% else %}ØºÙŠØ± Ù…Ø­Ø¯Ø¯{% endif %}</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="p-3 border rounded-3 bg-light h-100">
        <div class="text-muted small">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…ÙŠÙ† Ø§Ù„ÙƒÙ„ÙŠ</div>
        <div class="fw-bold">{{ kpi_total_teachers }}</div>
      </div>
    </div>
    <div class="col-6 col-md-2">
      <div class="p-3 border rounded-3 bg-light h-100">
        <div class="text-muted small">Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©</div>
        <div class="fw-bold text-success">{{ kpi_no_diff }}</div>
      </div>
    </div>
    <div class="col-6 col-md-2">
      <div class="p-3 border rounded-3 bg-light h-100">
        <div class="text-muted small">ÙŠÙˆØ¬Ø¯ ÙØ±ÙˆÙ‚Ø§Øª</div>
        <div class="fw-bold text-danger">{{ kpi_with_diff }}</div>
      </div>
    </div>
  </div>

  <hr>

  {% if teacher_items %}
    <div class="accordion" id="diffsAccordion">
      {% for item in teacher_items %}
        {% with t=item.teacher totals=item.totals diffs=item.diffs %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="hdr{{ t.id }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col{{ t.id }}" aria-expanded="false" aria-controls="col{{ t.id }}">
              <span class="me-2">{{ t.full_name }}</span>
              <span class="badge bg-secondary me-2">Ø§Ù„ØªÙƒÙ„ÙŠÙ: {{ totals.assign }}</span>
              <span class="badge bg-info text-dark me-2">Ø§Ù„Ø¬Ø¯ÙˆÙ„: {{ totals.time }}</span>
              {% if totals.diff == 0 %}
                <span class="badge bg-success">Ù…Ø·Ø§Ø¨Ù‚Ø©</span>
              {% elif totals.diff > 0 %}
                <span class="badge bg-warning text-dark">+{{ totals.diff }} Ø²ÙŠØ§Ø¯Ø©</span>
              {% else %}
                <span class="badge bg-danger">{{ totals.diff }} Ù†Ù‚Øµ</span>
              {% endif %}
            </button>
          </h2>
          <div id="col{{ t.id }}" class="accordion-collapse collapse" aria-labelledby="hdr{{ t.id }}" data-bs-parent="#diffsAccordion">
            <div class="accordion-body">
              <div class="table-responsive">
                <table class="table table-sm table-bordered align-middle text-center" style="direction: rtl;">
                  <thead class="table-light">
                    <tr>
                      <th class="text-start">Ø§Ù„ØµÙ</th>
                      <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                      <th>Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</th>
                      <th>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</th>
                      <th>Ø§Ù„ÙØ±Ù‚</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for r in diffs %}
                      <tr>
                        <td class="text-start">{% if r.class %}{{ r.class.name }}{% else %}-{% endif %}</td>
                        <td>{% if r.subject %}{{ r.subject.name_ar }}{% else %}-{% endif %}</td>
                        <td>{{ r.assign_weekly }}</td>
                        <td>{{ r.timetable_weekly }}</td>
                        <td>
                          {% if r.diff == 0 %}
                            <span class="badge bg-success">Ù…Ø·Ø§Ø¨Ù‚Ø©</span>
                          {% elif r.diff > 0 %}
                            <span class="badge bg-warning text-dark">+{{ r.diff }} Ø²ÙŠØ§Ø¯Ø©</span>
                          {% else %}
                            <span class="badge bg-danger">{{ r.diff }} Ù†Ù‚Øµ</span>
                          {% endif %}
                        </td>
                      </tr>
                    {% empty %}
                      <tr><td colspan="5" class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆÙ‚Ø§Øª.</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="small text-muted">Ø§Ù„ÙØ±Ù‚ = Ø§Ù„Ø¬Ø¯ÙˆÙ„ - Ø§Ù„ØªÙƒÙ„ÙŠÙ.</div>
            </div>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-success mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆÙ‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ØªÙƒÙ„ÙŠÙØ§Øª ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„. ÙƒÙ„ Ø´ÙŠØ¡ Ù…ØªØ·Ø§Ø¨Ù‚ ğŸ‰</div>
  {% endif %}
</div>

<style>
.accordion-button .badge { margin-inline-start: .5rem; }
</style>
{% endblock %}