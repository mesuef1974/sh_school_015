### ملخص تنفيذي
بناءً على كون المدرسة حكومية (بدون مدفوعات/فواتير) وبوجود أدوار إضافية مهمة (مشرف الأجنحة بمهام انضباطية/حضور فقط، ممرض/ة، أخصائي اجتماعي/نفسي، مشرف دعم وحالات خاصة)، هذه وثيقة صلاحيات مهنية مبنية على أفضل الممارسات (Least Privilege, Separation of Duties, Need-to-Know, Audit) مع توصيات عملية، ونموذج RBAC/ABAC قابل للتطبيق على أنظمة Django/DRF.

---

### مبادئ وضوابط عامة (أساس يُطبق على كل الأدوار)
- مبدأ أقل امتياز: امنح كل دور الحد الأدنى من الوصول اللازم لمهامه فقط.
- فصل الواجبات: فصل واضح بين الأكاديمي، الانضباطي، والصحي/النفسي/الاجتماعي.
- حساسية البيانات: تصنيف بيانات إلى: عامة، داخلية، حساسة (درجات/حضور)، شديدة الحساسية (صحية، نفسية، اجتماعية، خطط فردية IEP/ILP).
- التدرّج في النطاق: نظامي/مدرسي/جناح/قسم/صف/طالب (صلاحيات على مستوى الكائن عند الحاجة).
- السجلات والتدقيق: كل عرض/تعديل لبيانات حساسة يُسجّل مع سبب الوصول عند اللزوم.
- الحظر الافتراضي للتصدير: منع تنزيل البيانات الحساسة إلا بتفويض صريح وسجل موافقات.
- MFA للأدوار الحساسة: الإدارة، التوجيه، الصحي/النفسي/الاجتماعي.

---

### الموارد (Entities) داخل النظام
- المستخدمون/الأدوار، الطلاب، الفصول/الجداول، الحضور، السلوك/المخالفات، الغياب والهروب/التسرب، الإنذارات والإشعارات، التقييم/الدرجات، الخطط الفردية والدعم (IEP/ILP، accommodations)، السجلات الصحية (مطاعيم، زيارات عيادة المدرسة، أدوية، طوارئ)، السجلات النفسية/الاستشارات، السجلات الاجتماعية/الدعم الأسري، ملفات الحماية/حالات الخطر، الوثائق والتقارير.

---

### تعريف الأدوار وصلاحياتها (مُحدّث للحالة الحكومية)
1) Super Admin (تقني مركزي)
- الهدف: تشغيل المنصة وتكوينها العام.
- الصلاحيات: إدارة المستخدمين عالميًا، التكوين، التكاملات، النسخ الاحتياطي، مفاتيح API.
- القيود: لا عرض لمحتوى الطالب الحساس إلا عند الدعم الفني، مع ضوابط وصول مؤقت ومراجعة.

2) School Admin (مدير نظام المدرسة)
- الهدف: إدارة المدرسة ككيان تقني وإجرائي.
- الصلاحيات: إدارة المستخدمين المحليين، تعيين أدوار، إعداد السنة/الفصول/الجداول، سياسات الحضور والسلوك، تمكين وحدات (بدون مالية). عرض تقارير إجمالية غير حساسة + ملخصات امتثال (دون تفاصيل صحية/نفسية).
- القيود: لا يطّلع على سجلات صحية/نفسية/اجتماعية أو مذكرات سرية؛ ولا يعدّل الدرجات بعد الإقفال.

3) Principal (مدير المدرسة)
- الهدف: الإشراف العام واتخاذ القرارات.
- الصلاحيات: عرض شامل تقارير الحضور والانضباط والنتائج على مستوى المدرسة، اعتماد نهائي للنتائج بعد عمليات القسم، الموافقة على خطط وسياسات الانضباط والحماية.
- القيود: الاطلاع على الصحية/النفسية/الاجتماعية يكون بنطاق ملخصات إدارية ومؤشرات خطر مجهولة الهوية عند الإمكان، وتفاصيل حالة فقط عبر مسار قانوني (Need-to-Know) وبمراجعة.

4) Vice Principal (وكيل)
- الهدف: إدارة العمليات اليومية.
- الصلاحيات: متابعة التقارير التشغيلية للحضور والسلوك، إدارة إجراءات الغياب والهروب، إشراف على تنفيذ التوجيهات.
- القيود: صلاحيات أقل من المدير، لا تغييرات بنيوية كبيرة دون موافقة.

5) Wing Supervisor (مشرف جناح/مرحلة)
- الهدف: انضباط وحضور ضمن جناحه فقط.
- الصلاحيات:
  - اعتماد/تعديل الحضور والغياب ضمن الجناح.
  - تسجيل/اعتماد الحالات السلوكية (مخالفات، إنذارات) ضمن الجناح.
  - رصد وتوثيق حالات الهروب/التسرب ورفعها للوكيل/لجنة الحماية.
  - إرسال تنبيهات للمعلمين/الطلاب/الأولياء ضمن نطاقه حول الحضور والسلوك.
- القيود: لا يرى ولا يعدّل الدرجات أو التقييم الأكاديمي. لا وصول لبيانات صحية/نفسية/اجتماعية إلا المؤشرات التشغيلية غير المعرِّفة (مثلاً إشعار «قيود صحية تمنع الأنشطة الرياضية» بدون تفاصيل).

6) Department Head (رئيس قسم أكاديمي)
- الهدف: ضمان الجودة الأكاديمية داخل قسمه.
- الصلاحيات: إدارة عناصر التقييم في القسم، مراجعة درجات معلمي القسم قبل الإقفال، تقارير أداء أكاديمي للقسم.
- القيود: لا وصول للبيانات الصحية/النفسية/الاجتماعية، ولا سلوك خارج قسمه.

7) Homeroom Teacher (معلم صف)
- الهدف: متابعة صف محدد.
- الصلاحيات: تسجيل/تعديل حضور صفه، ملاحظات سلوكية أولية، تواصل مع أولياء أمور صفه، عرض درجات طلاب صفه في المواد عند الحاجة التنسيقية، رفع توصيات دعم للطلاب المحتاجين (تحوّيل للأخصائي/مشرف الدعم).
- القيود: لا يعتمد نتائج نهائية، لا يرى سجلات صحية/نفسية/اجتماعية؛ يستقبل فقط إشعارات مختصرة عند الضرورة (مثلاً «خطة علاجية تمنع نشاط كذا»).

8) Subject Teacher (معلم مادة)
- الهدف: التدريس والتقييم لمادته.
- الصلاحيات: إدخال وتعديل درجات مادته قبل الإقفال، تسجيل الحضور لحصصه، ملاحظات سلوكية متعلقة بالحصّة، رفع واجبات وأنشطة.
- القيود: لا وصول لبيانات صحية/نفسية/اجتماعية، ولا سلوك خارج مادته، ولا اعتماد نهائي للنتائج.

9) Counselor – Social Worker (أخصائي اجتماعي)
- الهدف: دراسة الحالات الاجتماعية والدعم الأسري والتدخلات.
- الصلاحيات: إنشاء/عرض/تحديث ملفات اجتماعية لطلاب مُحالين رسميًا، خطط تدخل اجتماعي، توثيق زيارات/تواصل أسري، ربط الحالات بلجنة الحماية.
- القيود: لا وصول لدرجات تفصيلية إلا مؤشرات عامة عند الحاجة (انخفاض مستمر). لا وصول لمذكرات نفسية أو تفاصيل صحية. تصدير البيانات ممنوع إلا بتفويض.

10) Counselor – Psychologist (أخصائي نفسي)
- الهدف: التقييم النفسي والإرشاد.
- الصلاحيات: إدارة ملفات نفسية للطلاب المُحالين، ملاحظات جلسات، تقييمات مقننة، خطط علاجية/توصيات تربوية.
- القيود: سرية عالية، لا تُشارك المذكرات إلا كخلاصات تربوية غير كاشفة للتفاصيل الحساسة. لا وصول للبيانات الاجتماعية التفصيلية سوى ما لزم للتدخل. لا درجات تفصيلية إلا مؤشرات عامة.

11) School Nurse (ممرض/ة المدرسة)
- الهدف: الرعاية الصحية المدرسية والطوارئ.
- الصلاحيات: السجل الصحي للطالب (مطاعيم، حساسية، أدوية)، تسجيل زيارات العيادة، خطط الطوارئ الفردية، تنبيهات صحية مقيّدة (مثلاً رموز/أيقونات تشير لاحتياطات بدون إفشاء السبب)، إدارة أذونات إعطاء الدواء بالتنسيق مع ولي الأمر.
- القيود: لا وصول للدرجات، ولا للمذكرات النفسية/الاجتماعية. تقارير صحية لا تُصدّر إلا بإذن رسمي وطمس بيانات غير لازمة.

12) Special Support Supervisor (مشرف الدعم والحالات الخاصة)
- الهدف: إدارة طلاب ذوي الاحتياجات الخاصة/الدعم الإضافي، والتنسيق مع المعلمين والأخصائيين.
- الصلاحيات: إنشاء/اعتماد خطط فردية IEP/ILP، توصيات التيسيرات (accommodations) بالصف/الاختبارات، متابعة التزام التنفيذ، الوصول لملخصات صحية/نفسية/اجتماعية قدر الحاجة وبعد موافقات، تقارير متابعة للقيادة.
- القيود: الوصول المفصل للصحّي/النفسي/الاجتماعي يكون بالطلب ولحالات معينة (object-level) مع سبب وصول. لا وصول للمالية (غير موجودة) ولا لصلاحيات نظامية عامة.

13) Student (طالب)
- الصلاحيات: عرض ملفه الدراسي (جدوله، واجباته، درجاته بعد الإصدار)، استلام تنبيهات، رفع واجبات.
- القيود: لا يرى بيانات غيره، ولا تقارير حساسة عنه (صحية/نفسية/اجتماعية) إلا إشعارات لزومية غير كاشفة.

14) Guardian/Parent (ولي أمر)
- الصلاحيات: عرض الحضور والدرجات المنشورة والسلوك المؤكد لأولاده، رسائل مع المعلمين/المرشدين ضمن ضوابط.
- القيود: لا وصول لملفات صحية/نفسية/اجتماعية مفصّلة؛ يتم عرض إشعارات/ملخصات فقط وفق سياسات موافقة ومصلحة الطفل.

15) IT Support (دعم تقني)
- الصلاحيات: إعادة تعيين كلمات المرور عبر مسارات موثّقة، الاطلاع على سجلات أخطاء تقنية.
- القيود: لا وصول لمحتوى بيانات الطلاب، ولا لأي سجلات حساسة.

16) Guest (زائر)
- الصلاحيات: محتوى عام فقط.
- القيود: لا بيانات شخصية.

اختياري (موصى به في المدارس الحكومية الكبيرة):
- Data Protection Officer (مسؤول حماية بيانات): مراقبة الامتثال، مراجعة سجلات الوصول، إدارة حوادث الخصوصية.

---

### مصفوفة صلاحيات مختصرة حسب المورد
- الحضور والغياب:
  - إدخال/تعديل: معلم المادة لحصته، معلم الصف لصفه.
  - اعتماد ضمن الجناح: مشرف الجناح.
  - تقارير عامة: الوكيل/المدير.
- السلوك والانضباط:
  - تسجيل أولي: المعلمون.
  - مراجعة واعتماد بالجناح: مشرف الجناح.
  - حالات خطرة/تصعيد: الوكيل/لجنة الحماية، الأخصائيون حسب الاختصاص.
- الهروب/التسرب:
  - رصد وتوثيق: مشرف الجناح والمعلمون.
  - متابعة وإجراءات: الوكيل + الأخصائي الاجتماعي.
- الدرجات والتقييم:
  - إدخال: معلم المادة.
  - مراجعة: رئيس القسم.
  - اعتماد نهائي: المدير (أو لجنة الاعتماد).
  - عرض: الطالب/ولي الأمر بعد الإصدار؛ معلم الصف للاطلاع على صفه؛ مشرف الجناح بلا وصول.
- الخطط الفردية والدعم (IEP/ILP):
  - إنشاء/تحديث: مشرف الدعم بالتعاون مع الأخصائيين.
  - عرض ملخصات تربوية: المعلمون المعنيون.
  - تفاصيل كاملة: حصرًا لطاقم الدعم وبموافقة.
- السجلات الصحية:
  - إدارة كاملة: الممرض/ة.
  - قراءة ملخصات غير كاشفة: المعلمون/مشرف الجناح عند الحاجة (مثال: «لا مشاركة في رياضات احتكاكية»).
- السجلات النفسية:
  - إدارة: الأخصائي النفسي.
  - مشاركة: خلاصات تربوية فقط مع المعلمين.
- السجلات الاجتماعية:
  - إدارة: الأخصائي الاجتماعي.
  - مشاركة: خلاصات لازمة مع الإدارة/المعلمين عند الحاجة.

---

### نطاقات الوصول (Scoping)
- المدرسة: جميع أدوار المدرسة محصورة بمدرستهم فقط.
- الجناح/المرحلة: مشرف الجناح ضمن نطاق مرحلته فقط.
- القسم: رئيس القسم ضمن قسمه فقط.
- الصف/المادة: المعلمون على صفوفهم وموادهم فقط.
- مستوى الكائن: صحة/نفسية/اجتماعية/خطط فردية تمنح فرديًا لحالات محددة مع سبب وصول وتاريخ صلاحية.

---

### ضوابط خصوصية متقدمة للبيانات الحساسة
- فصل قواعد البيانات المنطقية أو namespaces لملفات: صحية، نفسية، اجتماعية.
- تشفير على مستوى الحقل للمدخلات شديدة الحساسية (مفاتيح مُدارة آمنًا).
- إخفاء الهوية في التقارير القيادية متى أمكن.
- مسارات موافقة واضحة لمشاركة أي تفصيلة حساسة (Consent + Justification logging).
- منع البحث الحر عن النص الكامل في السجلات الحساسة لغير المختصين.
- إشعارات وصول فورية لصاحب الملف عند الاطلاع الحساس (حيث يسمح النظام/القانون).

---

### تطبيق عملي (Django/DRF) – أمثلة مقتضبة
- الأدوار كـ `Group`، وأذونات نماذج + أذونات على مستوى الكائن باستخدام `django-guardian`.
- نمذجة مجموعات جديدة: `Wing Supervisor`, `School Nurse`, `Counselor Social`, `Counselor Psych`, `Special Support Supervisor`.

```python
# setup_roles.py (مثال تهيئة)
from django.contrib.auth.models import Group, Permission
from django.contrib.contenttypes.models import ContentType
from school.models import Attendance, BehaviorIncident, EscapeCase, Grade, HealthRecord, PsychRecord, SocialRecord, IEPPlan

ROLE_GROUPS = [
    'Wing Supervisor', 'School Nurse', 'Counselor Social', 'Counselor Psych', 'Special Support Supervisor'
]
for name in ROLE_GROUPS:
    Group.objects.get_or_create(name=name)

# مثال: منح أذونات لمشرف الجناح على الحضور والسلوك فقط
wing = Group.objects.get(name='Wing Supervisor')
for model in [Attendance, BehaviorIncident, EscapeCase]:
    ct = ContentType.objects.get_for_model(model)
    perms = Permission.objects.filter(content_type=ct, codename__in=[
        f'view_{ct.model}', f'add_{ct.model}', f'change_{ct.model}'
    ])
    wing.permissions.add(*perms)

# حجب أي صلاحيات على الدرجات لمشرف الجناح (لا تُضفها أساسًا)

# الممرض/ة – صلاحيات السجلات الصحية فقط
nurse = Group.objects.get(name='School Nurse')
ct_health = ContentType.objects.get_for_model(HealthRecord)
for codename in [f'view_{ct_health.model}', f'add_{ct_health.model}', f'change_{ct_health.model}']:
    nurse.permissions.add(Permission.objects.get(content_type=ct_health, codename=codename))

# الأخصائي النفسي/الاجتماعي – فصل صارم بين النماذج
psych = Group.objects.get(name='Counselor Psych')
ct_psych = ContentType.objects.get_for_model(PsychRecord)
for c in [f'view_{ct_psych.model}', f'add_{ct_psych.model}', f'change_{ct_psych.model}']:
    psych.permissions.add(Permission.objects.get(content_type=ct_psych, codename=c))

social = Group.objects.get(name='Counselor Social')
ct_social = ContentType.objects.get_for_model(SocialRecord)
for c in [f'view_{ct_social.model}', f'add_{ct_social.model}', f'change_{ct_social.model}']:
    social.permissions.add(Permission.objects.get(content_type=ct_social, codename=c))

# مشرف الدعم – خطط IEP/ILP مع عرض ملخصات
support = Group.objects.get(name='Special Support Supervisor')
ct_iep = ContentType.objects.get_for_model(IEPPlan)
for c in [f'view_{ct_iep.model}', f'add_{ct_iep.model}', f'change_{ct_iep.model}']:
    support.permissions.add(Permission.objects.get(content_type=ct_iep, codename=c))
```

- صلاحيات على مستوى الكائن للحالات الحساسة:
```python
from guardian.shortcuts import assign_perm

# منح أخصائي نفسي حق الاطلاع على ملف نفسي لطالب محدد
assign_perm('view_psychrecord', user_psych, psych_record_obj)

# منح مشرف الدعم عرض خطة IEP لطالب محدد + مشاركة ملخص مع معلم المادة
assign_perm('view_iepplan', support_supervisor, iep_obj)
assign_perm('view_iepplan_summary', subject_teacher_user, iep_obj)
```

- أذونات DRF مخصّصة (أمثلة):
```python
from rest_framework.permissions import BasePermission

class IsWingScope(BasePermission):
    def has_object_permission(self, request, view, obj):
        return (
            request.user.groups.filter(name='Wing Supervisor').exists()
            and getattr(obj, 'wing_id', None) in request.user.profile.assigned_wings.values_list('id', flat=True)
        )

class IsNurseForSchool(BasePermission):
    def has_object_permission(self, request, view, obj):
        return request.user.groups.filter(name='School Nurse').exists() and obj.school_id == request.user.profile.school_id

class PsychOnly(BasePermission):
    def has_object_permission(self, request, view, obj):
        return request.user.groups.filter(name='Counselor Psych').exists() and obj.student_id in request.user.profile.assigned_students.values_list('id', flat=True)

class SocialOnly(BasePermission):
    def has_object_permission(self, request, view, obj):
        return request.user.groups.filter(name='Counselor Social').exists() and obj.student_id in request.user.profile.assigned_students.values_list('id', flat=True)

class SupportSupervisorAccess(BasePermission):
    def has_object_permission(self, request, view, obj):
        return request.user.groups.filter(name='Special Support Supervisor').exists() and obj.school_id == request.user.profile.school_id
```

- سياسات الواجهة: إخفاء/إظهار الحقول حسب الدور؛ استخدام شارات/أيقونات صحية عامة بدل النصوص التفصيلية.

---

### سيناريوهات تشغيلية مهمة (Workflow)
- اعتماد الحضور:
  - المعلم يسجل، مشرف الجناح يراجع ويعتمد يوميًا، الوكيل يتابع مؤشرات التأخر.
- حادثة سلوكية:
  - تسجيل من المعلم، مراجعة واعتماد من مشرف الجناح، تصعيد للحالات الخطرة (لجنة حماية/أخصائي اجتماعي) مع قنوات موثّقة.
- حالة هروب/تسرب:
  - توثيق مشرف الجناح، إخطار ولي الأمر، خطة متابعة مشتركة مع الأخصائي الاجتماعي.
- حالة صحية طارئة:
  - وصول الممرض/ة لملف الطالب فورًا، إشعار الإدارة، تسجيل الواقعة، مشاركة ملخص لطاقم التدريس عند الحاجة.
- إحالة نفسية/اجتماعية:
  - طلب من معلم الصف/الوكيل، موافقة مديرية عند الحاجة، فتح ملف مخصص، تقييد الوصول على مستوى الكائن.
- خطة IEP/ILP:
  - يقودها مشرف الدعم مع الأخصائيين، مشاركة ملخصات تنفيذية مع المعلمين، مراجعة دورية، توقيف رؤية الخطة لمن لا حاجة له.

---

### أفضل الممارسات العملية الخاصة بالأدوار الجديدة
- مشرفو الأجنحة:
  - لوحات متابعة يومية للحضور والسلوك، مؤشرات خطر (تكرار غياب)، دون معلومات أكاديمية/صحية.
  - قوالب جزاءات/إشعارات معيارية، مع منع النص الحر المسيء.
- الممرض/ة:
  - نموذج إذن دواء موقّع إلكترونيًا، تنبيهات صلاحية المطاعيم، سجل إتلاف معلومات (retention policy).
- الأخصائي الاجتماعي/النفسي:
  - قوالب ملاحظات منظمة، حواجز مشاركة: ملخص تربوي فقط للمدرسين. تتبّع الموافقات وحضور الجلسات.
- مشرف الدعم:
  - مكتبة تيسيرات قياسية (extra time, seating, reduced workload)، تدقيق التزام التنفيذ، تقارير امتثال دون تفاصيل حساسة.

---

### الحوكمة والامتثال
- مراجعة وصول ربع سنوية للأدوار الحساسة.
- سجلات تدقيق: عرض/تعديل/تصدير للسجلات الحساسة مع سبب الوصول.
- إنهاء وصول تلقائي عند تغير وظيفة المستخدم (Revocation on role change).
- اختبارات صلاحيات آلية على واجهات API والـ Admin.

---

### ما الذي أزلناه لتوافق «مدرسة حكومية»
- كافة أدوار/شاشات/صلاحيات المالية والمدفوعات والمحاسبة.
- قنوات تحصيل الرسوم أو تقاريرها.

---

### أسئلة لتخصيص أدق قبل الإقفال
- ما الهيكل الدقيق للأجنحة/الأقسام؟ وكيف تُسند الطلاب لها؟
- هل توجد لجنة حماية مدرسية رسمية ومسار تصعيد محدد؟
- ما السياسات الوطنية حول سرية السجلات الصحية/النفسية المدرسية؟
- ما حجم المدرسة وعدد الأخصائيين؟ (لتحديد إن كانت الأدوار تُدمج أم تبقى منفصلة)
- ما متطلبات التقارير الدورية للوزارة؟ (مجهولة الهوية أو مفصلة مع موافقات)

---

### خلاصة
تمت إعادة تصميم الأدوار والصلاحيات بما يلائم مدرسة حكومية، مع فصل صارم بين الأكاديمي والانضباطي والصحي/النفسي/الاجتماعي، ومنح مشرف الأجنحة صلاحيات الحضور والسلوك فقط، وإضافة أدوار الممرض/ة والأخصائيين ومشرف الدعم بخيارات وصول مبنية على مستوى الكائن والتصاريح المسبقة. هذه الخريطة قابلة للتنفيذ مباشرة على RBAC في Django مع `django-guardian` للكيانات الحساسة، وتراعي أفضل الممارسات المهنية والامتثال.