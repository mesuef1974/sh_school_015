<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>توثيق API — عرض احترافي (OpenAPI)</title>
  <link rel="icon" href="/static/img/favicon.ico">
  <style>
    :root {
      --brand: #6e0303;
      --ink: #222;
      --bg: #f7f7f9;
      --card: #ffffff;
    }
    @font-face {
      font-family: 'NotoKufiArabic';
      src: url('/static/fonts/ArbFonts.com/ArbFONTS-NotoKufiArabic-VariableFont_wght.ttf') format('truetype');
      font-weight: 100 900; font-style: normal; font-display: swap;
    }
    body { margin: 0; background: var(--bg); color: var(--ink); font-family: 'NotoKufiArabic', system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif; }
    header { background: var(--brand); color: #fff; padding: 12px 16px; }
    header h1 { margin: 0; font-size: 1.15rem; }
    .container { width: 100%; margin: 0; background: var(--card); }
    .toolbar { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-bottom: 1px solid #eee; background: #fafafa; }
    .toolbar a { color: var(--brand); text-decoration: none; font-size: .95rem; }
    .toolbar a:hover { text-decoration: underline; }
    /* Make ReDoc friendlier for RTL */
    redoc, .redoc-wrap { direction: rtl; }
  </style>
  <!-- ReDoc via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js"></script>
</head>
<body>
  <header>
    <h1>توثيق واجهة برمجة التطبيقات — Shahania School API</h1>
  </header>
  <div class="toolbar">
    <div class="container" style="display:flex;justify-content:space-between;">
      <div>
        <a href="/docs/">العودة إلى منصة الوثائق</a>
      </div>
      <div style="display:flex; gap:12px;">
        <a href="#" id="download-yaml" download>تحميل ملف YAML</a>
        <a href="https://editor.swagger.io/?url=" target="_blank" id="open-swagger">فتح في Swagger Editor</a>
      </div>
    </div>
  </div>
  <div class="container">
    <redoc id="redoc-container"></redoc>
  </div>
  <script>
    // Resolve schema URL across contexts (Django dev server or static IDE/file preview)
    (function() {
      try {
        var proto = window.location.protocol;
        var host = window.location.hostname || 'localhost';
        var port = window.location.port;
        var qs = new URLSearchParams(window.location.search);
        var override = qs.get('backend'); // allow ?backend=127.0.0.1:8000
        var defaultBase = 'http://127.0.0.1:8000';
        var base = override ? (override.match(/^https?:\/\//) ? override : ('http://' + override)) : defaultBase;
        var nonDjango = (proto === 'file:') || (host === 'localhost' && port && port !== '8000') || (host === '127.0.0.1' && port && port !== '8000');
        var schemaPath = '/backend/schema.yaml';
        var schemaUrl = nonDjango ? (base + schemaPath) : schemaPath;
        // Update links
        var dl = document.getElementById('download-yaml');
        dl.href = schemaUrl;
        var sw = document.getElementById('open-swagger');
        sw.href = 'https://editor.swagger.io/?url=' + encodeURIComponent(schemaUrl);
        // Initialize ReDoc with resolved URL
        Redoc.init(schemaUrl, {
          hideDownloadButton: false,
          expandResponses: '200,201',
          requiredPropsFirst: true,
          pathInMiddlePanel: true,
          theme: {
            typography: { fontFamily: 'NotoKufiArabic, Segoe UI, Tahoma, Arial, sans-serif' },
            colors: { primary: { main: '#6e0303' } }
          }
        }, document.getElementById('redoc-container'));
      } catch (e) {
        console.error(e);
      }
    })();
  </script>
</body>
</html>